function dataExtractionFromeLearningLog() {
  //Open spreadsheet containing lists of logs and get all sheets by name
  var dataSpreadsheet = SpreadsheetApp.openByUrl("https://docs.google.com/spreadsheets/d/1A-UCy3jALebq8iOdeWvoJCKOfI1GaacH-KRbeyKzOdc/edit#gid=814593233");
  var year2013Data = dataSpreadsheet.getSheetByName('2013');
  var year2014Data = dataSpreadsheet.getSheetByName('2014');
  var year2015Data = dataSpreadsheet.getSheetByName('2015');
  var year2016Data = dataSpreadsheet.getSheetByName('2016');
  var year2017Data = dataSpreadsheet.getSheetByName('2017');
  var year2018Data = dataSpreadsheet.getSheetByName('2018');
  var year2019Data = dataSpreadsheet.getSheetByName('2019');
  var extractionData = dataSpreadsheet.getSheetByName('Extraction Data');
  var extractedData = dataSpreadsheet.getSheetByName('Extracted Data');
  var htmlSheet = dataSpreadsheet.getSheetByName('HTML');
  //Explore the 2018 sheet
  //Read data extraction information
  var range = extractionData.getDataRange();
  var dataValues = range.getValues();
  var sitePageName = dataValues[0][0];
  //var q1 = dataValues[0][2];
  //var q2 = dataValues[1][2];
  //var q3 = dataValues[2][2];
  //var q4 = dataValues[3][2];
  //var q5 = dataValues[4][2];
  //var q6 = dataValues[5][2];
  //var q7 = dataValues[6][2];
  //var q8 = dataValues[7][2];
  //var ssq1 = dataValues[0][1];
  //var ssq2 = dataValues[1][1];
  //var ssq3 = dataValues[2][1];
  //var ssq4 = dataValues[3][1];
  //var ssq5 = dataValues[4][1];
  //var ssq6 = dataValues[5][1];
  //var ssq7 = dataValues[6][1];
  //var ssq8 = dataValues[7][1];
  var length = dataValues.length; //The number of questions on the page

  //Write data to Extracted data sheet
  extractedData.getRange(1,1).setValue("Student");
  for (var i = 0; i < dataValues.length; i++){
    extractedData.getRange(1,i+2).setValue(dataValues[i][2]);
  }

  //This is the start of the loop through all the student logs, first read the student name, then form the site url
  for (var row = 2; row < 134; row++){ 
  //var column = 1;
  var studentID = extractedData.getRange(row,1).getValue();
  var logUrl = "https://sites.google.com/a/york.ac.uk/" + studentID + sitePageName;
  //var logUrl1 = year2018Data.getRange(row,column).getValue();
  //Open site
  //Open a page by its url
  //I can construct the url of each page using the username which can be found from cell row, column = 1 of 2018 sheet
  //then just add /term-1/after-induction to the end
  //https://sites.google.com/a/york.ac.uk/xw1648/term-1/after-induction
  var sitePage = SitesApp.getPageByUrl(logUrl);
  //getHtmlContent() as string
  var pageHTML = sitePage.getHtmlContent();
  //extractedData.getRange(row,1).setValue(studentID);
  //extractedData.getRange(5,1).setValue(pageHTML.substring(0));
  //parse this text
  //find first statement "Do you think it will be what you expected?"
  //var textPart1 = pageHTML.substring(0);
  for (var j = 0; j < dataValues.length; j++){
    //var j = 1;
    //This loops through each response on the selected page
    var location = pageHTML.search(dataValues[j][1]);  //Search String, substitute j for 0
    var textPart1 = pageHTML.substring(location);
    var location = textPart1.search("<td"-3);
    textPart1 = textPart1.substring(dataValues[j][2].length); //Length of actual question, substitute j for 0
    location = textPart1.search("<td");
    textPart1 = textPart1.substring(location);
    location = textPart1.search("</td>");
    var answer = cleanString(textPart1.substring(0,location));
    //textPart1 = textPart1.substring(answer.length);
    extractedData.getRange(row,j+2).setValue(answer); //Write answer to Extracted Data sheet in row corresponding to student and column, 2 corresponding to the question j
  }
  }
}
function cleanString(dirtyString){
  var tempString = dirtyString;
  var cleanString = "";
  var position = 0;
  while (tempString.search("<") >= 0){
    position = tempString.search("<");
    if (position > 0){
      cleanString = cleanString + tempString.substring(0,position);
    }
    tempString = tempString.substring(position);
    position = tempString.search(">");
    tempString = tempString.substring(position+1);
  }
  return cleanString
}
